<!--
  ~ Copyright 2012 The Broad Institute, Inc.
  ~ SOFTWARE COPYRIGHT NOTICE
  ~ This software and its documentation are the copyright of the Broad Institute, Inc. All rights are reserved.
  ~
  ~ This software is supplied without any warranty or guaranteed support whatsoever. The Broad Institute is not responsible for its use, misuse, or functionality.
  --><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:a4j="https://ajax4jsf.dev.java.net/ajax" xmlns:c="http://java.sun.com/jsp/jstl/core">
    <ui:composition>
        <h:outputText rendered="#{runTaskBean.allowBatchProcess and !runTaskBean.visualizer}">
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/jqueryFileTree/jquery-1.2.3.min.js" />
            <script>
                jQuery.noConflict();
            </script>
        </h:outputText>
        <h:outputText>
            <script>
                var versionPrompt = #{runTaskBean.versionPrompt};
                var moduleBaseLsid = "#{runTaskBean.lsidNoVersion}";
                var highestVersion = #{runTaskBean.highestVersion};
                if (versionPrompt) if (!highestVersion) {
                    showDialog("New Version Available",
                            "The version of " + "#{runTaskBean.name}" + " you have chosen is not the latest version available on this server.  Would you like to use the latest version?", {
                                "Use Latest Version":function () {
                                    self.location = "/gp/pages/index.jsf?lsid=" + moduleBaseLsid;
                                },
                                "Use This Version":function () {
                                    jq(this).dialog("close");
                                }});
                }
            </script>
        </h:outputText>
        <h:outputText rendered="#{not runTaskBean.allowNewJob}">
            <div class="server_error_message">
                <b>Important message: </b>New jobs are not allowed because there is not enough disk space available.
            </div>
        </h:outputText>
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td>
                </td>
                <td valign="top" class="maintasknav" id="maintasknav">
                    <span id="toggleDescForm">
                        <h:outputText rendered="#{runTaskBean.showParameterDescriptions}">
                            <input name="toggleDesc" id="toggleDesc" onclick="toggleDescriptions();" type="checkbox" checked="checked" />
                            <label for="toggleDesc">
                                Show parameter descriptions
                            </label>
                        </h:outputText>
                        <h:outputText rendered="#{! runTaskBean.showParameterDescriptions}">
                            <h:selectBooleanCheckbox id="toggleDesc" onclick="toggleDescriptions();">
                                Show parameter descriptions
                            </h:selectBooleanCheckbox>
                        </h:outputText>
                    </span>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                </td>
            </tr>
        </table>
        <table width="100%" border="0" cellpadding="0" cellspacing="0" class="barhead-task">
            <tr>
                <td>
                    #{runTaskBean.name}
                </td>
                <td align="right">
                    <span class="barhead-version">version #{runTaskBean.version} &#160;</span>
                    <!-- Version menu popup icon.  Conditionally render -->
                    <h:outputText rendered="#{!empty runTaskBean.versions}">
                        <img src="#{facesContext.externalContext.requestContextPath}/images/smallOptions.gif" 
                        	name="Image_versionPopupMenu" id="Image_versionPopupMenu" border="0" valign="middle" 
                        	onmouseover="MM_swapImage('Image_versionPopupMenu','','#{facesContext.externalContext.requestContextPath}/images/smallOptions2.gif',2)" 
                        	onmouseout="MM_swapImgRestore();" />
                        <script type="text/javascript" language="javascript">menuRegistry._create("#Image_versionPopupMenu", "#versionPopupMenu");</script>
                        <br />
                    </h:outputText>
                </td>
            </tr>
        </table>
        <form action="#{facesContext.externalContext.requestContextPath}/#{runTaskBean.formAction}" method="post" id="taskForm" enctype="multipart/form-data" onsubmit="return validateForm();">
            <input type="hidden" id="taskLSID" name="taskLSID" value="#{runTaskBean.encodedLsid}" /><input type="hidden" id="taskName" name="taskName" value="#{runTaskBean.name}" />
            <table border="0" cellpadding="5" cellspacing="0" class="attribute" valign="top">
                <tbody>
                    <h:outputText rendered="#{runTaskBean.pipelineWithMissingTasks}">
                        <tr class="taskperameter">
                            <td colspan="3">
                                <font color="red" size="+1">
                                    <b>Warning:</b>
                                </font>
                                <br />
                                This pipeline requires modules or module versions which are not installed on this server.
                                <br />
                                Go to the <a href="#{facesContext.externalContext.requestContextPath}/viewPipeline.jsp?name=#{runTaskBean.lsid}">properties</a>
                                page to install the required modules.
                            </td>
                        </tr>
                    </h:outputText>
                    <tr class="taskperameter">
                        <td>
                            <span class="description">
                                <h:outputText rendered="#{runTaskBean.inputParametersExist}">
                                    * required field
                                </h:outputText>
                            </span>
                        </td>
                        <td colspan="2" class="maintasknav2">
                            <h:outputText rendered="#{runTaskBean.allowNewJob}">
                                <h:outputText rendered="#{not runTaskBean.pipelineWithMissingTasks}">
                                    <input id="cmd1" name="cmd1" value="Run" type="submit" /><input id="reset" name="reset" value="Reset" type="button" onclick="document.location='#{facesContext.externalContext.requestContextPath}/pages/index.jsf?lsid=#{runTaskBean.encodedLsid}'" />
                                </h:outputText>
                                <h:outputText rendered="#{runTaskBean.pipelineWithMissingTasks}">
                                    <input id="properties" name="properties" value="Install missing tasks" type="button" onclick="document.location='#{facesContext.externalContext.requestContextPath}/viewPipeline.jsp?name=#{runTaskBean.lsid}'" />
                                </h:outputText>
                            </h:outputText>&#160;&#160;
                            <h:outputText rendered="#{runTaskBean.pipeline}">
                                <a href="#{facesContext.externalContext.requestContextPath}/viewPipeline.jsp?name=#{runTaskBean.lsid}">properties</a>&#160;|&#160;<a onclick="exportPipeline('#{runTaskBean.lsid}', '#{runTaskBean.name}');" href="#">export</a>
                                <h:outputText rendered="#{runTaskBean.editAllowed}">
                                    &#160;|&#160;<a href="#{facesContext.externalContext.requestContextPath}/pipeline/index.jsf?lsid=#{runTaskBean.lsid}">edit</a>
                                </h:outputText>
                            </h:outputText>
                            <h:outputText rendered="#{!runTaskBean.pipeline}">
                                <a href="#{facesContext.externalContext.requestContextPath}/addTask.jsp?name=#{runTaskBean.lsid}&#38;view=1">properties</a>&#160;|&#160;<a href="#{facesContext.externalContext.requestContextPath}/makeZip.jsp?name=#{runTaskBean.lsid}">export</a>
                                <h:panelGroup rendered="#{runTaskBean.editAllowed}">
                                    &#160;|&#160;<a href="#{facesContext.externalContext.requestContextPath}/modules/creator.jsf?lsid=#{runTaskBean.lsid}">edit</a>
                                </h:panelGroup>
                            </h:outputText>
                            <h:outputText rendered="#{runTaskBean.hasDoc}">
                                &#160;|&#160;<a target="_blank" href="#{facesContext.externalContext.requestContextPath}/getTaskDoc.jsp?name=#{runTaskBean.lsid}">documentation</a>
                            </h:outputText>
                        </td>
                    </tr>
                    <!-- Loop through parameters -->
                    <t:dataList value="#{runTaskBean.parameters}" var="p">
                        <tr>
                            <!-- Parameter label -->
                            <td valign="top" class="#{p.optional==false ? 'attribute-required' : ''}" style="white-space: nowrap;">
                                #{p.displayName} <h:outputText rendered="#{!p.optional}" value="*" />
                            </td>
                            <td valign="top" id="#{p.name}_td">
                                <h:outputText rendered="${p.inputType=='directory'}">
                                    <!--Directory -->
                                    <div id="#{p.name}_div_url">
                                        <h:outputText value="Specify Directory" />
                                        <input name="#{p.name}_url" id="#{p.name}_url" size="30" type="text" value="#{p.defaultValue}" />
                                        <input type="checkbox" name="#{p.name}_batch" id="#{p.name}_batch" value="true" /><label for="{p.name}_batch">Batch Parameter</label>
                                    </div>
                                </h:outputText>
                                <h:outputText rendered="#{p.inputType=='file'}">
                                    <h:outputText rendered="#{empty p.defaultValue}">
                                        <div id="#{p.name}_div_file">
                                            <input name="#{p.name}" id="#{p.name}" size="30" type="file" />

                                            <div>
                                                Select a single file under 2GB to upload.
                                                <h:outputText rendered="#{runTaskBean.allowBatchProcess}">
                                                    To execute a batch upload or upload files over 2GB use the "Upload Files" tool in the Uploads tab on the right.
                                                </h:outputText>
                                            </div>
                                        </div>
                                        <div id="#{p.name}_div_url" style="display:none">
                                            <input id="#{p.name}_url" name="#{p.name}_url" size="30" type="text" value="#{p.defaultValue}" />
                                            <input type="checkbox" name="#{p.name}_batch" id="#{p.name}_batch" value="true" /><label for="{p.name}_batch">Batch Parameter</label>
                                            <h:outputText rendered="#{runTaskBean.allowInputFilePaths}">
                                                <a rel="lyteframe" title="Browse for #{p.name}" rev="width: 400px; height: 300px; scrolling: auto" href="#{facesContext.externalContext.requestContextPath}/jqueryFileTree/index.jsf?p=#{p.name}">Browse Server File System...</a>
                                            </h:outputText>

                                            <div>
                                                Enter a URL
                                                <h:outputText rendered="#{runTaskBean.allowInputFilePaths}">
                                                    or path name
                                                </h:outputText>
                                                to the file you wish to input.
                                            </div>
                                        </div>
                                        <span class="description" style="display:inline"><input type="radio" id="#{p.name}_cb_url" name="#{p.name}_cb" value="url" onclick="showUrlInput('#{p.name}');" />
                                            <label for="#{p.name}_cb_url">
                                                <h:outputText value="#{runTaskBean.allowInputFilePaths ? 'Specify File Path or URL' : 'Specify URL'}" />
                                            </label>
                                        </span><span class="description" style="display:inline"><input type="radio" id="#{p.name}_cb_file" name="#{p.name}_cb" value="file" onclick="showFileInput('#{p.name}');" checked="yes" />
                                            <label for="#{p.name}_cb_file">
                                                Basic Upload
                                            </label>
                                        </span>
                                    </h:outputText>
                                    <h:outputText rendered="#{!empty p.defaultValue}">
                                        <div id="#{p.name}_div_file" style="display:none">
                                            <input name="#{p.name}" id="#{p.name}" size="30" type="file" />
                                        </div>
                                        <div id="#{p.name}_div_url">
                                            <input id="#{p.name}_url" name="#{p.name}_url" size="30" type="text" value="#{p.defaultValue}" />
                                            <input type="checkbox" name="#{p.name}_batch" id="#{p.name}_batch" value="true" /><label for="{p.name}_batch">Batch Parameter</label>
                                            <h:outputText rendered="#{runTaskBean.allowInputFilePaths}">
                                                <a rel="lyteframe" title="Browse for #{p.name}" rev="width: 400px; height: 300px; scrolling: auto" href="#{facesContext.externalContext.requestContextPath}/jqueryFileTree/index.jsf?p=#{p.name}">Browse Server File System...</a>
                                            </h:outputText>
                                        </div>
                                        <span class="description" style="display:inline"><input type="radio" id="#{p.name}_cb_url" name="#{p.name}_cb" value="url" onclick="showUrlInput('#{p.name}');" checked="yes">
                                            <h:outputText rendered="#{runTaskBean.allowInputFilePaths}">
                                                Specify File Path or URL
                                            </h:outputText>
                                            <h:outputText rendered="#{!runTaskBean.allowInputFilePaths}">
                                                Specify URL
                                            </h:outputText>
                                        </input>
                                        </span>
                                        <span class="description" style="display:inline"><input type="radio" id="#{p.name}_cb_file" name="#{p.name}_cb" value="file" onclick="showFileInput('#{p.name}');">Basic Upload
                                        </input></span>
                                    </h:outputText>
                                </h:outputText><!-- Select list input -->
                                <h:outputText rendered="#{p.inputType=='select'}">
                                    <select name="#{p.name}" id="#{p.name}">
                                        <t:dataList value="#{p.choices}" var="c">
                                            <h:outputText rendered="#{c.selected}">
                                                <option value="#{c.value}" selected="true">#{c.label}</option>
                                            </h:outputText>
                                            <h:outputText rendered="#{!c.selected}">
                                                <option value="#{c.value}">#{c.label}</option>
                                            </h:outputText>
                                        </t:dataList>
                                    </select>
                                </h:outputText>
                                <!--  Text or password input -->
                                <h:outputText rendered="#{p.inputType=='text' || p.inputType=='password'}">
                                    <input name="#{p.name}" id="#{p.name}" size="30" type="#{p.inputType}" value="#{p.defaultValue}" />
                                </h:outputText>
                            </td>
                        </tr>
                        <tr class="taskperameter">
                            <td />
                            <h:outputText rendered="#{runTaskBean.showParameterDescriptions}">
                                <td valign="top" class="description">
                                    <span class="parameter_description" style="display:inline">#{p.displayDescription}</span>
                                </td>
                            </h:outputText>
                            <h:outputText rendered="#{!runTaskBean.showParameterDescriptions}">
                                <td valign="top" class="description">
                                    <span class="parameter_description" style="display:none">#{p.displayDescription}</span>
                                </td>
                            </h:outputText>
                        </tr>
                    </t:dataList>
                    <h:outputText rendered="#{!empty runTaskBean.parameters}">
                        <tr>
                            <td valign="top">
                                &#160;
                            </td>
                            <td colspan="2" class="maintasknav2">
                                <h:outputText rendered="#{runTaskBean.allowNewJob}">
                                    <h:outputText rendered="#{not runTaskBean.pipelineWithMissingTasks}">
                                        <input id="cmd2" name="cmd2" value="Run" type="submit" /><input id="reset2" name="reset2" value="Reset" onclick="document.location='#{facesContext.externalContext.requestContextPath}/pages/index.jsf?lsid=#{runTaskBean.encodedLsid}'" type="button" />&#160;&#160;
                                    </h:outputText>
                                </h:outputText>
                                <h:outputText rendered="#{runTaskBean.pipeline}">
                                    <a href="#{facesContext.externalContext.requestContextPath}/viewPipeline.jsp?name=#{runTaskBean.lsid}">properties</a>&#160;|&#160;<a onclick="exportPipeline('#{runTaskBean.lsid}', '#{runTaskBean.name}');" href="#">export</a>
                                    <h:outputText rendered="#{runTaskBean.editAllowed}">
                                        &#160;|&#160;<a href="#{facesContext.externalContext.requestContextPath}/pipeline/index.jsf?lsid=#{runTaskBean.lsid}">edit</a>
                                    </h:outputText>
                                </h:outputText>
                                <h:outputText rendered="#{!runTaskBean.pipeline}">
                                    <a href="#{facesContext.externalContext.requestContextPath}/addTask.jsp?name=#{runTaskBean.lsid}&#38;view=1">properties</a>&#160;|&#160;<a href="#{facesContext.externalContext.requestContextPath}/makeZip.jsp?name=#{runTaskBean.lsid}">export</a>
                                    <h:panelGroup rendered="#{runTaskBean.editAllowed}">
                                        &#160;|&#160;<a href="#{facesContext.externalContext.requestContextPath}/modules/creator.jsf?lsid=#{runTaskBean.lsid}">edit</a>
                                    </h:panelGroup>
                                </h:outputText>
                                <h:outputText rendered="#{runTaskBean.hasDoc}">
                                    &#160;|&#160;<a target="_blank" href="#{facesContext.externalContext.requestContextPath}/getTaskDoc.jsp?name=#{runTaskBean.lsid}">documentation</a>
                                </h:outputText>
                            </td>
                        </tr>
                    </h:outputText>
                </tbody>
            </table>
            <p>
                &#160;
            </p>
            <br />

            <div class="download_code">
                <strong>View code to call
                    #{runTaskBean.name}: </strong>

                <div id="codeDiv">
                    &#160;
                </div>
                <select name="gp_languageSelector" id="gp_languageSelector">
                    <option selected="selected">- Language -</option>
                    <option>Java</option>
                    <option>MATLAB</option>
                    <option>R</option>
                </select>
                &#160; <input name="viewCodeBtn" id="viewCodeBtn" type="button" onclick="viewCode();" value="View Code" />
            </div>
        </form>
    </ui:composition>
</html>