<!--
  ~ Copyright 2012 The Broad Institute, Inc.
  ~ SOFTWARE COPYRIGHT NOTICE
  ~ This software and its documentation are the copyright of the Broad Institute, Inc. All rights are reserved.
  ~
  ~ This software is supplied without any warranty or guaranteed support whatsoever. The Broad Institute is not responsible for its use, misuse, or functionality.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
        <title>Consensus Clustering</title>
        <link href="../../css/protocolsWindow.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="../../js/protocol.js"></script>
    </head>

    <body>

        <h1>Consensus Clustering</h1>
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td align="left">
                    <a href="protocols.html">protocols</a>
                </td>
            </tr>
        </table>

        <p>
            Determine an optimal number of clusters by repeatedly running a selected clustering algorithm. Examine the resulting consensus matrix to assess the stability of the resulting clusters.</p>

        <div class="steps">
            <h2>Before you begin</h2>

            <p>Gene expression data must be in a <a href="GctResFiles.html">GCT or RES file</a>.
                <br />
                Example file: <a href="ftp://ftp.broadinstitute.org/pub/genepattern/datasets/all_aml/all_aml_test.gct">all_aml_test.gct</a>.</p>
            <table width="100%" border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td align="right">learn more:<br>
                        <a href="http://www.broadinstitute.org/cancer/software/genepattern/gp_guides/file-formats#gct">file formats</a>
                    </td>
                </tr>
            </table>
        </div>
        <div class="steps">
            <h2>Step 1: PreprocessDataset</h2>

            <p>Preprocess gene expression data
                to remove platform noise and genes that have little variation.
                Although researchers generally preprocess data before clustering if doing so removes relevant biological information, skip this step. </p>

            <div class="gpLinks">
                <ul>
                    <li><a href="/gp/pages/index.jsf?lsid=PreprocessDataset"
                           onclick="return openModuleWindow(this, event);"
                            >Open module</a> in the GenePattern window.
                    </li>
                    <li><a href="/gp/pages/index.jsf?lsid=PreprocessDataset&input.filename=ftp://ftp.broadinstitute.org/pub/genepattern/datasets/all_aml/all_aml_test.gct"
                           onclick="return openModuleWindow(this, event);"
                            >Open module with example data</a> in the GenePattern window.
                    </li>
                </ul>
            </div>
            <h5>Considerations</h5>
            <ul>
                <li>PreprocessDataset can preprocess the data in one or more ways (in this order):
                    <ol>
                        <li>Set threshold and ceiling values. Any value lower/higer than the threshold/ceiling
                            value is reset to the threshold/ceiling value.
                        </li>
                        <li>Convert each expression value to the log base 2 of the value.</li>
                        <li>Remove genes (rows) if a given number of its sample values are less than
                            a given threshold.
                        </li>
                        <li>Remove genes (rows) that do not have a minimum fold change or expression
                            variation.
                        </li>
                        <li>Discretize or normalize the data.</li>
                    </ol>
                </li>
                <li>When using ratios to compare gene expression between samples,
                    convert values to log base 2 of the value to
                    bring up- and down-regulated genes to the same scale.
                    For example, ratios of 2 and .5 indicating two-fold changes for up- and
                    down-regulated expression, respectively, are converted to +1 and -1.
                </li>
                <li>If you did not generate the expression data,
                    check whether preprocessing steps have already been taken before
                    running the PreprocessDataset module.
                </li>
            </ul>

            <table width="100%" border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td align="right">learn more:<br>
                        <a href="/gp/getTaskDoc.jsp?name=PreprocessDataset">PreprocessDataset</a>
                    </td>
                </tr>
            </table>
        </div>


        <div class="steps">
            <h2>Step 2: ConsensusClustering</h2>

            <p>ConsensusClustering runs a selected clustering algorithm
                (by default, hierarchical clustering) against perturbations of the gene
                expression data a selected number of times (by default, 20). It assesses
                the stability of the resulting clusters by creating a consensus matrix.</p>

            <p>For
                every pair of objects, the matrix records the number of times both
                are assigned to the same cluster divided by the number of times both are
                in the perturbed data set. A consensus matrix where all values are 0 or 1
                corresponds to perfect consensus.
            </p>

            <div class="gpLinks">
                <ul>
                    <li><a href="/gp/pages/index.jsf?lsid=ConsensusClustering"
                           onclick="return openModuleWindow(this, event);"
                            >Open ConsensusClustering</a></li>
                    <li><a href="/gp/pages/index.jsf?lsid=ConsensusClustering&input.filename=ftp://ftp.broadinstitute.org/pub/genepattern/datasets/protocols/all_aml_test.preprocessed.gct"
                           onclick="return openModuleWindow(this, event);"
                            >Open ConsensusClustering with example data</a></li>

                </ul>
            </div>
            <h5>Considerations</h5>
            <ul>
                <li>ConsensusClustering clusters genes or samples, not both.</li>
                <li>ConsensusClustering groups objects (genes or samples) into <i>k</i> clusters.
                    It groups objects into two clusters, then three clusters, up to the maximum
                    number of clusters specified by the <i>kmax</i> parameter (by default,
                    5). The module builds a separate consensus matrix for each set of clusters.
                </li>
                <li>Best practice is to normalize the data being clustered (<i>normalize type</i> parameter).</li>
            </ul>

            <table width="100%" border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td align="right">learn more:<br>
                        <a href="/gp/getTaskDoc.jsp?name=ConsensusClustering">ConsensusClustering</a>
                    </td>
                </tr>
            </table>
        </div>

        <div class="steps">
            <h2>Step 3: HeatMapViewer</h2>

            <p>Run the HeatMapViewer module to view the consensus matrices.
                The consensus matrix is formatted as a GCT file.
                The HeatMapViewer displays the consensus matrix as a heat map.
                A consensus matrix where all values are dark blue (0) or dark red (1) corresponds to perfect consensus.</p>

            <div class="gpLinks">
                <ul>
                    <li><a href="/gp/pages/index.jsf?lsid=HeatMapViewer"
                           onclick="return openModuleWindow(this, event);"
                            >Open HeatMapViewer</a></li>
                    <li><a href="/gp/pages/index.jsf?lsid=HeatMapViewer&dataset=ftp://ftp.broadinstitute.org/pub/genepattern/datasets/protocols/all_aml_test.preprocessed.sub28.srt.2.gct"
                           onclick="return openModuleWindow(this, event);"
                            >Open HeatMapViewer with example data</a></li>
                </ul>
            </div>


            <h5>Considerations</h5>
            <ul>
                <li>For more about the consensus matrix and its interpretation, see Monti
                    et al., 2003.
                </li>
                <li>ConsensusClustering also creates a text file (*.clu) listing the items belonging to
                    each cluster, text files (*.clsdist, *.stdev) listing the cluster statistics, and a .pdf file showing statistical plots (Lorenz curve, Gini index, Consensus CDF) that can be used to determine the
                    best number of clusters.
                    To display any of these files, click the file.
                </li>

            </ul>


            <table width="100%" border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td align="right">
                        learn more:<br>
                        <a href="/gp/getTaskDoc.jsp?name=HeatMapViewer">HeatMapViewer</a><br />
                        <a href="/gp/getTaskDoc.jsp?name=ConsensusClustering">ConsensusClustering</a>

                    </td>
                </tr>
            </table>

        </div>

        <h2>References</h2>

        <p>Monti, S., Tamayo, P., Mesirov, J.P., and Golub, T. 2003. Consensus Clustering: A resampling-based method for class discovery and visualization of gene expression microarray data. <i>Machine Learning Journal</i> 52(1-2):91-118.</p>

    </body>
</html>
