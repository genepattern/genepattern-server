<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core">


<head>
<title>Ajax polling demo</title>
<script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/prototype.js"/>
<script type="text/javascript">
/* <![CDATA[ */
// Execute a jsf el expression on the server
function callManagedBean(elExpression) {            
  var opt = {
    method:    'post',
    postBody:  'el=' + elExpression,
    onSuccess: receiveResponse,
    onFailure: function(t) {
      alert('Error ' + t.status + ' -- ' + t.statusText);
    }
  } 
  new  Ajax.Request('#{facesContext.externalContext.requestContextPath}/anyThingAtAll.ajax',opt);
}

// The callback function - receive response from server
function receiveResponse( req ) {
  if (req.readyState == 4) {
    if (req.status == 200) { // only if "OK"
      var label = document.getElementById("outputLabel");
      label.value = req.responseText;
    } 
    else {
      alert("There was a problem retrieving the XML data:\n" + req.statusText);
    }  
  }
}


var timerID = 0;

function startPolling(elExpression, interval) {
   callManagedBean( elExpression );
   timerID  = setTimeout("startPolling('" + elExpression + "', " + interval + ")", interval);
}

function stopPolling() {
   if(timerID) {
      clearTimeout(timerID);
      timerID  = 0;
   }
}
		
/* ]]> */
</script>
</head>
<body>
  <table>
    <tr>
      <td>
        <input type="button" value="Start" onclick="startPolling('currentTimeBean.currentTime', 500);"/>
      </td>
      <td>
        <input type="button" value="Stop" onclick="stopPolling();"/>
      </td>
      <td>
        <textArea id="outputLabel">&#160;&#160;&#160;&#160;</textArea>
      </td>
    </tr>
  </table>

</body>
</html>
